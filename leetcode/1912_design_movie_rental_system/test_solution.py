import collections
import logging

import pytest

from solution import MovieRentingSystem

Step = collections.namedtuple("Step", ["action", "args", "expected"])


@pytest.mark.parametrize(
    "steps",
    [
        pytest.param(
            [
                Step(
                    action="MovieRentingSystem",
                    args=[
                        3,
                        [
                            [0, 1, 5],
                            [0, 2, 6],
                            [0, 3, 7],
                            [1, 1, 4],
                            [1, 2, 7],
                            [2, 1, 5],
                        ],
                    ],
                    expected=None,
                ),
                Step(action="search", args=[1], expected=[1, 0, 2]),
                Step(action="rent", args=[0, 1], expected=None),
                Step(action="rent", args=[1, 2], expected=None),
                Step(action="report", args=[], expected=[[0, 1], [1, 2]]),
                Step(action="drop", args=[1, 2], expected=None),
                Step(action="search", args=[2], expected=[0, 1]),
            ],
            id="example 1",
        ),
        pytest.param(
            [
                Step(
                    action="MovieRentingSystem",
                    args=[
                        10,
                        [
                            [0, 418, 3],
                            [9, 5144, 46],
                            [2, 8986, 29],
                            [6, 1446, 28],
                            [3, 8215, 97],
                            [7, 9105, 34],
                            [6, 9105, 30],
                            [5, 1722, 94],
                            [9, 528, 40],
                            [3, 850, 77],
                            [3, 7069, 40],
                            [8, 1997, 42],
                            [0, 8215, 28],
                            [7, 4050, 80],
                            [4, 7100, 97],
                            [4, 9686, 32],
                            [4, 2566, 93],
                            [2, 8320, 12],
                            [2, 5495, 56],
                        ],
                    ],
                    expected=None,
                ),
                Step(action="search", args=[7837], expected=[]),
                Step(action="search", args=[5495], expected=[2]),
                Step(action="rent", args=[4, 7100], expected=None),
                Step(action="search", args=[9105], expected=[6, 7]),
                Step(action="search", args=[1446], expected=[6]),
                Step(action="report", args=[], expected=[[4, 7100]]),
                Step(action="search", args=[9869], expected=[]),
                Step(action="drop", args=[4, 7100], expected=None),
            ],
            id="wrong 1",
        ),
        pytest.param(
            [
                Step(
                    action="MovieRentingSystem",
                    args=[
                        69,
                        [
                            [16, 4156, 1511],
                            [20, 8501, 8417],
                            [34, 7901, 7776],
                            [54, 6691, 9511],
                            [44, 8931, 8434],
                            [42, 9640, 5251],
                            [22, 4534, 9161],
                            [32, 6506, 6831],
                            [13, 8501, 731],
                            [4, 7610, 8474],
                            [33, 820, 2341],
                            [17, 6490, 1161],
                            [29, 7120, 2703],
                            [8, 8723, 7613],
                            [38, 9544, 1804],
                            [30, 8723, 1047],
                            [1, 5015, 7763],
                            [60, 1625, 2383],
                            [29, 3336, 3542],
                            [39, 7535, 6066],
                            [1, 9074, 9400],
                            [39, 1625, 7944],
                            [26, 9160, 6874],
                            [55, 2465, 888],
                            [35, 8530, 6025],
                        ],
                    ],
                    expected=None,
                ),
                Step(action="rent", args=[32, 6506], expected=None),
                Step(action="search", args=[8501], expected=[13, 20]),
                Step(action="search", args=[6275], expected=[]),
                Step(action="report", args=[], expected=[[32, 6506]]),
                Step(action="rent", args=[30, 8723], expected=None),
                Step(action="rent", args=[8, 8723], expected=None),
                Step(
                    action="report",
                    args=[],
                    expected=[[30, 8723], [32, 6506], [8, 8723]],
                ),
                Step(
                    action="report",
                    args=[],
                    expected=[[30, 8723], [32, 6506], [8, 8723]],
                ),
                Step(action="search", args=[6699], expected=[]),
                Step(action="search", args=[115], expected=[]),
                Step(action="rent", args=[20, 8501], expected=None),
                Step(action="rent", args=[16, 4156], expected=None),
                Step(action="search", args=[9447], expected=[]),
                Step(action="drop", args=[30, 8723], expected=None),
                Step(action="drop", args=[8, 8723], expected=None),
                Step(action="drop", args=[32, 6506], expected=None),
                Step(action="drop", args=[16, 4156], expected=None),
                Step(action="rent", args=[42, 9640], expected=None),
                Step(action="report", args=[], expected=[[42, 9640], [20, 8501]]),
                Step(action="report", args=[], expected=[[42, 9640], [20, 8501]]),
                Step(action="rent", args=[17, 6490], expected=None),
                Step(action="drop", args=[20, 8501], expected=None),
                Step(action="search", args=[8175], expected=[]),
                Step(action="report", args=[], expected=[[17, 6490], [42, 9640]]),
                Step(action="drop", args=[17, 6490], expected=None),
                Step(action="report", args=[], expected=[[42, 9640]]),
                Step(action="drop", args=[42, 9640], expected=None),
                Step(action="rent", args=[54, 6691], expected=None),
                Step(action="report", args=[], expected=[[54, 6691]]),
                Step(action="search", args=[1625], expected=[60, 39]),
                Step(action="search", args=[3291], expected=[]),
                Step(action="rent", args=[60, 1625], expected=None),
                Step(action="rent", args=[39, 1625], expected=None),
                Step(
                    action="report",
                    args=[],
                    expected=[[60, 1625], [39, 1625], [54, 6691]],
                ),
                Step(
                    action="report",
                    args=[],
                    expected=[[60, 1625], [39, 1625], [54, 6691]],
                ),
                Step(action="drop", args=[60, 1625], expected=None),
                Step(action="report", args=[], expected=[[39, 1625], [54, 6691]]),
                Step(action="report", args=[], expected=[[39, 1625], [54, 6691]]),
                Step(action="drop", args=[39, 1625], expected=None),
                Step(action="report", args=[], expected=[[54, 6691]]),
                Step(action="drop", args=[54, 6691], expected=None),
                Step(action="rent", args=[8, 8723], expected=None),
                Step(action="drop", args=[8, 8723], expected=None),
                Step(action="search", args=[2260], expected=[]),
                Step(action="rent", args=[29, 7120], expected=None),
                Step(action="search", args=[746], expected=[]),
                Step(action="drop", args=[29, 7120], expected=None),
                Step(action="rent", args=[38, 9544], expected=None),
                Step(action="drop", args=[38, 9544], expected=None),
                Step(action="report", args=[], expected=[]),
                Step(action="rent", args=[1, 9074], expected=None),
                Step(action="drop", args=[1, 9074], expected=None),
                Step(action="rent", args=[54, 6691], expected=None),
                Step(action="rent", args=[39, 1625], expected=None),
                Step(action="drop", args=[54, 6691], expected=None),
                Step(action="report", args=[], expected=[[39, 1625]]),
                Step(action="report", args=[], expected=[[39, 1625]]),
                Step(action="report", args=[], expected=[[39, 1625]]),
                Step(action="report", args=[], expected=[[39, 1625]]),
                Step(action="rent", args=[26, 9160], expected=None),
                Step(action="drop", args=[26, 9160], expected=None),
                Step(action="report", args=[], expected=[[39, 1625]]),
                Step(action="drop", args=[39, 1625], expected=None),
                Step(action="rent", args=[42, 9640], expected=None),
                Step(action="search", args=[9640], expected=[]),
                Step(action="drop", args=[42, 9640], expected=None),
                Step(action="report", args=[], expected=[]),
                Step(action="rent", args=[29, 7120], expected=None),
                Step(action="search", args=[5630], expected=[]),
                Step(action="search", args=[1842], expected=[]),
                Step(action="report", args=[], expected=[[29, 7120]]),
                Step(action="rent", args=[16, 4156], expected=None),
                Step(action="report", args=[], expected=[[16, 4156], [29, 7120]]),
                Step(action="report", args=[], expected=[[16, 4156], [29, 7120]]),
                Step(action="rent", args=[1, 9074], expected=None),
                Step(
                    action="report",
                    args=[],
                    expected=[[16, 4156], [29, 7120], [1, 9074]],
                ),
                Step(
                    action="report",
                    args=[],
                    expected=[[16, 4156], [29, 7120], [1, 9074]],
                ),
                Step(action="search", args=[7992], expected=[]),
                Step(action="rent", args=[4, 7610], expected=None),
                Step(action="rent", args=[29, 3336], expected=None),
                Step(action="search", args=[1333], expected=[]),
            ],
            id="wrong 2",
        ),
        pytest.param(
            [
                Step(
                    action="MovieRentingSystem",
                    args=[
                        22,
                        [
                            [13, 6406, 5183],
                            [10, 2926, 931],
                            [0, 6424, 7126],
                            [0, 4988, 4028],
                            [6, 8295, 7660],
                            [16, 4729, 3008],
                            [7, 6349, 8844],
                            [1, 6896, 3047],
                            [8, 4693, 3264],
                            [13, 1984, 6267],
                            [14, 4544, 5627],
                            [21, 6347, 1327],
                            [7, 4932, 3085],
                            [16, 5577, 1542],
                            [11, 9549, 2609],
                            [5, 8830, 5502],
                            [19, 3157, 6780],
                            [1, 7953, 5964],
                            [7, 1882, 6571],
                            [18, 9932, 1146],
                            [17, 5985, 2625],
                            [19, 8434, 4176],
                            [19, 1762, 3420],
                            [13, 2558, 984],
                            [4, 4693, 6178],
                            [17, 6347, 3059],
                            [17, 5808, 1467],
                            [21, 7778, 1596],
                            [1, 47, 7419],
                            [15, 646, 8719],
                            [10, 1694, 9782],
                            [6, 5577, 5867],
                            [11, 6406, 4180],
                            [12, 6347, 7325],
                            [1, 1112, 8378],
                            [8, 6750, 3274],
                            [12, 531, 8300],
                            [8, 7672, 6253],
                            [17, 5551, 6090],
                            [14, 4321, 597],
                            [16, 8872, 2453],
                            [5, 9630, 3367],
                            [7, 8872, 9900],
                            [16, 3238, 5601],
                            [9, 9630, 9659],
                            [12, 431, 2143],
                            [13, 646, 6596],
                            [12, 7953, 1106],
                            [17, 1564, 5806],
                            [9, 4988, 2545],
                            [20, 3852, 3190],
                            [16, 7953, 7802],
                            [19, 646, 7631],
                            [21, 9816, 46],
                            [11, 7778, 37],
                        ],
                    ],
                    expected=None,
                ),
                Step(action="rent", args=[1, 7953], expected=None),
                Step(action="report", args=[], expected=[[1, 7953]]),
                Step(action="drop", args=[1, 7953], expected=None),
                Step(action="rent", args=[11, 9549], expected=None),
                Step(action="report", args=[], expected=[[11, 9549]]),
                Step(action="report", args=[], expected=[[11, 9549]]),
                Step(action="search", args=[531], expected=[12]),
                Step(action="rent", args=[17, 6347], expected=None),
                Step(action="search", args=[9998], expected=[]),
                Step(action="rent", args=[12, 431], expected=None),
                Step(action="drop", args=[11, 9549], expected=None),
                Step(action="report", args=[], expected=[[12, 431], [17, 6347]]),
                Step(action="rent", args=[9, 9630], expected=None),
                Step(
                    action="report",
                    args=[],
                    expected=[[12, 431], [17, 6347], [9, 9630]],
                ),
                Step(action="rent", args=[12, 6347], expected=None),
                Step(action="rent", args=[14, 4321], expected=None),
                Step(action="drop", args=[9, 9630], expected=None),
                Step(
                    action="report",
                    args=[],
                    expected=[[14, 4321], [12, 431], [17, 6347], [12, 6347]],
                ),
                Step(action="rent", args=[0, 4988], expected=None),
                Step(action="rent", args=[13, 6406], expected=None),
                Step(action="rent", args=[11, 7778], expected=None),
                Step(
                    action="report",
                    args=[],
                    expected=[[11, 7778], [14, 4321], [12, 431], [17, 6347], [0, 4988]],
                ),
                Step(action="rent", args=[8, 4693], expected=None),
            ],
            id="",
        ),
    ],
)
def test_solution(steps):
    obj = None
    for index, (action, args, expected) in enumerate(steps):
        logging.debug("============================================================")
        args_str = ", ".join(repr(arg) for arg in args)
        logging.debug("Step [%d] %s(%s)", index, action, args_str)

        if action == "MovieRentingSystem":
            obj = MovieRentingSystem(*args)
        else:
            logging.debug("expected=%r", expected)
            method = getattr(obj, action)
            assert method is not None
            actual = method(*args)
            logging.debug("actual=  %r", actual)
            assert actual == expected
